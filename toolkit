<!DOCTYPE html>
<html lang="en" class=""> <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Security Toolkit + AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
    <!-- Marked Library for rendering Markdown from AI -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Light Theme Colors */
            --bg-primary: #f1f5f9;
            --bg-secondary: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --accent-color: #6366f1;
            --accent-hover: #4f46e5;
            --green-bg: #f0fdf4; --green-text: #166534; --green-border: #bbf7d0;
            --red-bg: #fef2f2; --red-text: #991b1b; --red-border: #fecaca;
            --amber-bg: #fffbeb; --amber-text: #92400e; --amber-border: #fde68a;
            --chat-bg-user: #e0e7ff;
            --chat-bg-bot: #f3f4f6;
        }

        html.dark {
            /* Dark Theme Colors */
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --green-bg: #14532d; --green-text: #bbf7d0; --green-border: #22c55e;
            --red-bg: #7f1d1d; --red-text: #fecaca; --red-border: #ef4444;
            --amber-bg: #78350f; --amber-text: #fde68a; --amber-border: #f59e0b;
            --chat-bg-user: #3730a3;
            --chat-bg-bot: #334155;
        }
        
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-primary); color: var(--text-primary); transition: background-color 0.3s ease, color 0.3s ease; }
        .main-container { background-color: var(--bg-secondary); border: 1px solid var(--border-color); transition: background-color 0.3s ease, border-color 0.3s ease; }
        .tab-button { border-bottom: 2px solid transparent; color: var(--text-secondary); transition: all 0.3s ease; }
        .tab-button:hover { background-color: var(--bg-primary); color: var(--accent-color); }
        .tab-active { border-color: var(--accent-color); color: var(--accent-color); background-color: color-mix(in srgb, var(--accent-color) 10%, transparent); }
        .option-btn.correct { background-color: var(--green-bg); border-color: var(--green-border); color: var(--green-text); }
        .option-btn.incorrect { background-color: var(--red-bg); border-color: var(--red-border); color: var(--red-text); }
        .precaution-steps { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-in-out, padding-top 0.4s ease-in-out; }
        .precaution-item.active .precaution-steps { max-height: 500px; padding-top: 0.75rem; }
        input, select, textarea { background-color: var(--bg-primary); border-color: var(--border-color); color: var(--text-primary); }
        input:focus, select, textarea:focus { --tw-ring-color: var(--accent-color); }
        
        /* Chat Animations */
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .chat-window { animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .typing-dot { animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        /* Markdown Styling inside Chat */
        .prose-sm p { margin-bottom: 0.5em; }
        .prose-sm ul { list-style-type: disc; padding-left: 1.2em; margin-bottom: 0.5em; }
        .prose-sm code { background-color: rgba(0,0,0,0.1); padding: 0.1em 0.3em; border-radius: 0.2em; font-family: monospace; }
        html.dark .prose-sm code { background-color: rgba(255,255,255,0.1); }
    </style>
</head>
<body class="min-h-screen p-4 flex items-center justify-center relative">

    <div class="main-container w-full max-w-3xl rounded-2xl shadow-2xl p-6 md:p-8 mb-20 md:mb-0">
        <!-- HEADER -->
        <header class="flex justify-between items-start mb-8">
            <div class="text-left">
                <h1 class="text-3xl font-bold" data-lang-key="title">Digital Security Toolkit</h1>
                <p style="color: var(--text-secondary);" class="mt-1" data-lang-key="subtitle">Simple tools to help you stay safe online.</p>
            </div>
            <div class="flex items-center space-x-2 flex-shrink-0">
                <button id="language-toggle" class="p-2 w-16 text-center text-sm font-semibold rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)] focus:ring-[var(--accent-color)] text-[var(--text-secondary)] hover:text-[var(--accent-color)] hover:bg-[var(--bg-primary)] transition-all duration-300">
                    <span data-lang-key="langToggle">EN / HI</span>
                </button>
                <button id="theme-toggle" class="p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)] focus:ring-[var(--accent-color)] text-[var(--text-secondary)] hover:text-[var(--accent-color)] hover:bg-[var(--bg-primary)] transition-all duration-300">
                    <svg id="theme-icon-light" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                    <svg id="theme-icon-dark" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
                </button>
            </div>
        </header>

        <!-- TABS -->
        <div class="flex border-b overflow-x-auto" style="border-color: var(--border-color);">
            <button data-tab="metadata" class="tab-button tab-active flex-1 py-3 px-2 text-sm md:text-base font-medium whitespace-nowrap transition-all duration-300 focus:outline-none" data-lang-key="tabMetadata">Metadata Remover</button>
            <button data-tab="password" class="tab-button flex-1 py-3 px-2 text-sm md:text-base font-medium whitespace-nowrap transition-all duration-300 focus:outline-none" data-lang-key="tabPassword">Password Tools</button>
            <button data-tab="encryption" class="tab-button flex-1 py-3 px-2 text-sm md:text-base font-medium whitespace-nowrap transition-all duration-300 focus:outline-none">Secure Message</button>
            <button data-tab="link" class="tab-button flex-1 py-3 px-2 text-sm md:text-base font-medium whitespace-nowrap transition-all duration-300 focus:outline-none" data-lang-key="tabLink">Smart Pattern Scanner</button>
            <button data-tab="awareness" class="tab-button flex-1 py-3 px-2 text-sm md:text-base font-medium whitespace-nowrap transition-all duration-300 focus:outline-none" data-lang-key="tabAwareness">Threat Awareness</button>
        </div>

        <div class="min-h-[450px] pt-6">
            <!-- Metadata Tool -->
            <div id="metadata-tool" class="tab-content">
                <h2 class="text-xl font-semibold text-[var(--text-primary)] mb-2" data-lang-key="metadataTitle">Remove Image Metadata</h2>
                <p class="text-[var(--text-secondary)] mb-4 text-sm" data-lang-key="metadataDesc">Upload a photo to view its hidden data and download a clean, metadata-free version. Your photo is processed in your browser and is never uploaded.</p>
                <label for="image-upload" class="w-full cursor-pointer bg-[var(--bg-primary)] border-2 border-dashed border-[var(--border-color)] rounded-lg flex flex-col items-center justify-center p-6 hover:bg-opacity-70 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-[var(--text-secondary)] mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>
                    <span class="font-medium text-[var(--text-primary)]" data-lang-key="metadataUpload">Click to upload an image</span>
                    <span id="file-name" class="text-xs text-[var(--text-secondary)] mt-1"></span>
                </label>
                <input type="file" id="image-upload" class="hidden" accept="image/jpeg, image/png">
                <div id="metadata-result" class="mt-4"></div>
            </div>

            <!-- Password Tool (Generator + Checker) -->
            <div id="password-tool" class="tab-content hidden">
                 <h2 class="text-xl font-semibold mb-2" data-lang-key="passwordTitle">Password Tools</h2>
                 <p style="color: var(--text-secondary);" class="mb-6 text-sm" data-lang-key="passwordDesc">Generate strong passwords or check if an existing one has been compromised.</p>
                 
                 <!-- NEW PASSWORD GENERATOR SECTION -->
                 <div class="mb-8 p-5 border rounded-xl bg-[var(--bg-primary)] shadow-sm relative overflow-hidden" style="border-color: var(--border-color);">
                    <div class="absolute top-0 left-0 w-1 h-full bg-[var(--accent-color)]"></div>
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-semibold text-[var(--accent-color)] flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" /></svg>
                            Generate Strong Password
                        </h3>
                    </div>

                    <!-- Display & Copy -->
                    <div class="flex gap-2 mb-4">
                        <div class="relative flex-1">
                            <input type="text" id="generated-password" readonly class="w-full px-4 py-3 border rounded-lg bg-[var(--bg-secondary)] font-mono text-lg tracking-wider text-center focus:outline-none" style="border-color: var(--border-color);" placeholder="Click generate...">
                        </div>
                        <button id="copy-password" title="Copy to Clipboard" class="px-4 bg-gray-200 dark:bg-gray-700 text-[var(--text-primary)] rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            <svg id="copy-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 01-2 2h-8a2 2 0 01-2-2v-8a2 2 0 012-2z" /></svg>
                        </button>
                        <button id="generate-btn" title="Generate New" class="px-4 bg-[var(--accent-color)] text-white rounded-lg hover:bg-[var(--accent-hover)] transition-colors shadow-lg shadow-indigo-500/30">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                        </button>
                    </div>

                    <!-- Options -->
                    <div class="flex flex-wrap gap-4 text-sm text-[var(--text-secondary)] justify-center sm:justify-start items-center bg-[var(--bg-secondary)] p-3 rounded-lg border border-[var(--border-color)]">
                        <div class="flex items-center w-full sm:w-auto">
                            <span class="mr-2 font-medium">Length:</span>
                            <input type="range" id="pass-length-slider" min="8" max="32" value="16" class="w-full sm:w-32 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 mr-2 accent-[var(--accent-color)]">
                            <span id="pass-length-val" class="font-mono font-bold text-[var(--accent-color)] w-6 text-center">16</span>
                        </div>
                        <div class="w-px h-4 bg-gray-300 dark:bg-gray-600 mx-2 hidden sm:block"></div>
                        <label class="flex items-center cursor-pointer select-none hover:text-[var(--text-primary)]">
                            <input type="checkbox" id="use-symbols" checked class="w-4 h-4 rounded border-gray-300 text-[var(--accent-color)] focus:ring-[var(--accent-color)] mr-2">
                            Symbols (!@#)
                        </label>
                        <label class="flex items-center cursor-pointer select-none hover:text-[var(--text-primary)]">
                            <input type="checkbox" id="use-numbers" checked class="w-4 h-4 rounded border-gray-300 text-[var(--accent-color)] focus:ring-[var(--accent-color)] mr-2">
                            Numbers (123)
                        </label>
                    </div>
                </div>

                 <!-- Check Password Section -->
                 <div class="pt-4 border-t" style="border-color: var(--border-color);">
                     <h3 class="font-semibold mb-3">Check Breach Status</h3>
                     <div class="relative">
                         <input type="password" id="password-input" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:border-transparent" placeholder="Enter a password to check...">
                         <button id="toggle-password" type="button" class="absolute inset-y-0 right-0 px-4 text-[var(--text-secondary)]">
                             <svg id="eye-open" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z" /><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.022 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" /></svg>
                             <svg id="eye-closed" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2 2 0 012.828 2.828l1.515 1.515A4 4 0 0014 10a4 4 0 10-5.732-2.443z" clip-rule="evenodd" /><path d="M10.707 15.293a1 1 0 01-1.414 0l-1.414-1.414a1 1 0 111.414-1.414l1.414 1.414a1 1 0 010 1.414zM4.458 10a9.953 9.953 0 001.325 3.971l1.515-1.515a4 4 0 015.424-5.424l1.515-1.515A9.953 9.953 0 0010 4.542 9.953 9.953 0 004.458 10z" /></svg>
                         </button>
                     </div>
                     <button id="check-password-btn" class="w-full mt-4 bg-[var(--accent-color)] text-white py-3 rounded-lg font-semibold hover:bg-[var(--accent-hover)] transition-colors" data-lang-key="passwordBtn">Check Password</button>
                     <div id="password-result" class="mt-4"></div>
                 </div>
            </div>

            <!-- Secure Encryption Tool -->
            <div id="encryption-tool" class="tab-content hidden">
                <h2 class="text-xl font-semibold mb-2">AES-256 Secure Messaging</h2>
                <p style="color: var(--text-secondary);" class="mb-6 text-sm">Encrypt a secret message using a password. The data is processed locally using the Web Crypto API and never leaves your device.</p>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Secret Password (Key)</label>
                        <input type="password" id="crypto-key" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:border-transparent" placeholder="Enter a shared secret password">
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Input Text</label>
                            <textarea id="crypto-input" rows="5" class="w-full px-4 py-2 border rounded-lg font-mono text-sm" placeholder="Type message to encrypt OR paste code to decrypt..."></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Output Result</label>
                            <textarea id="crypto-output" rows="5" readonly class="w-full px-4 py-2 border rounded-lg bg-[var(--bg-primary)] font-mono text-sm" placeholder="Result will appear here..."></textarea>
                        </div>
                    </div>

                    <div class="flex gap-3">
                        <button id="btn-encrypt" class="flex-1 bg-[var(--accent-color)] text-white py-3 rounded-lg font-semibold hover:bg-[var(--accent-hover)] transition-colors flex justify-center items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" /></svg>
                            Encrypt
                        </button>
                        <button id="btn-decrypt" class="flex-1 bg-gray-600 text-white py-3 rounded-lg font-semibold hover:bg-gray-700 transition-colors flex justify-center items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" /></svg>
                            Decrypt
                        </button>
                    </div>
                </div>
            </div>

            <!-- Pattern Scanner Tool (Heuristic) -->
            <div id="link-tool" class="tab-content hidden">
                 <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-1" data-lang-key="linkTitle">Smart Pattern Scanner</h2>
                    <p style="color: var(--text-secondary);" class="text-sm">Detects suspicious links and risky file types locally using pattern recognition.</p>
                 </div>

                 <!-- Tabs for Link vs File -->
                 <div class="flex gap-2 mb-4">
                     <button id="mode-link" class="flex-1 py-2 text-sm font-semibold rounded bg-[var(--accent-color)] text-white shadow">Scan URL</button>
                     <button id="mode-file" class="flex-1 py-2 text-sm font-semibold rounded bg-[var(--bg-primary)] text-[var(--text-secondary)] hover:bg-gray-200 dark:hover:bg-gray-700">Scan File Type</button>
                 </div>

                 <!-- URL Input -->
                 <div id="vt-url-section">
                     <input type="text" id="link-input" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:border-transparent font-mono text-sm" placeholder="https://example.com/login.php">
                     <button id="scan-link-btn" class="w-full mt-4 bg-[var(--accent-color)] text-white py-3 rounded-lg font-semibold hover:bg-[var(--accent-hover)] transition-colors">Analyze Link</button>
                 </div>

                 <!-- File Input -->
                 <div id="vt-file-section" class="hidden">
                    <label class="w-full cursor-pointer bg-[var(--bg-primary)] border-2 border-dashed border-[var(--border-color)] rounded-lg flex flex-col items-center justify-center p-8 hover:bg-opacity-70 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-[var(--text-secondary)] mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                        <span class="text-sm font-medium text-[var(--text-primary)]">Select file to analyze</span>
                        <input type="file" id="vt-file-input" class="hidden">
                    </label>
                    <div id="vt-file-name" class="text-xs text-center mt-2 text-[var(--text-secondary)]"></div>
                    <button id="scan-file-btn" class="w-full mt-4 bg-[var(--accent-color)] text-white py-3 rounded-lg font-semibold hover:bg-[var(--accent-hover)] transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>Analyze File</button>
                 </div>

                 <div id="link-result" class="mt-4"></div>
            </div>
            
            <!-- Awareness Tool -->
            <div id="awareness-tool" class="tab-content hidden space-y-8">
                <div>
                    <h2 class="text-xl font-semibold mb-2" data-lang-key="awarenessGameTitle">Scam Awareness Game & Alerts</h2>
                    <p style="color: var(--text-secondary);" class="mb-4 text-sm" data-lang-key="awarenessGameDesc">Test your knowledge with uniquely generated real-world scenarios.</p>
                    <div id="game-and-alert-content">
                        <div id="scam-alert-container" class="relative mb-4 p-4 rounded-lg" style="background-color: var(--amber-bg); border: 1px solid var(--amber-border);">
                            <button id="refresh-alert-btn" title="Generate new AI alert" class="absolute top-2 right-2 p-1 text-[var(--amber-text)] hover:bg-black/10 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[var(--amber-bg)] focus:ring-amber-500 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h5M20 20v-5h-5M4 4l1.5 1.5A9 9 0 0119.5 19.5M20 20l-1.5-1.5A9 9 0 004.5 4.5" /></svg>
                            </button>
                            <div class="flex items-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-500 mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
                                <div id="scam-alert-content" class="pr-6">
                                    <h3 id="scam-alert-title" class="font-bold" style="color: var(--amber-text);" data-lang-key="loadingAlert">Generating AI Alert...</h3>
                                    <p id="scam-alert-description" class="text-sm mt-1" style="color: var(--amber-text);">Please wait while the AI scans for the latest threat trends.</p>
                                </div>
                            </div>
                        </div>
                        <div id="game-area" class="mt-6">
                            <div id="game-start-screen">
                                <button id="start-game-btn" class="w-full bg-[var(--accent-color)] text-white py-3 rounded-lg font-semibold hover:bg-[var(--accent-hover)] transition-colors" data-lang-key="startGameBtn">Start AI Awareness Game</button>
                            </div>
                            <div id="game-question-screen" class="hidden">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="font-semibold" data-lang-key="scenarioTitle">Scenario (AI Generated)</h3>
                                    <p id="game-score" class="text-sm font-medium text-[var(--accent-color)] bg-opacity-10 bg-[var(--accent-color)] px-3 py-1 rounded-full"><span data-lang-key="scorePrefix">Score</span>: 0</p>
                                </div>
                                <div id="game-loading" class="hidden flex justify-center py-8">
                                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-[var(--accent-color)]"></div>
                                </div>
                                <p id="game-scenario" class="bg-[var(--bg-primary)] p-4 rounded-lg border border-[var(--border-color)] mb-4 min-h-[100px]"></p>
                                <div id="game-options" class="space-y-3"></div>
                                <div id="game-feedback" class="mt-4"></div>
                                <button id="game-next-btn" class="w-full mt-4 bg-[var(--accent-color)] text-white py-3 rounded-lg font-semibold hover:bg-[var(--accent-hover)] transition-colors hidden" data-lang-key="nextQuestionBtn">Next Question</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="border-t my-8" style="border-color: var(--border-color);"></div>

                <div>
                    <h2 class="text-xl font-semibold mb-2" data-lang-key="precautionsTitle">Essential Security Checklist</h2>
                    <p style="color: var(--text-secondary);" class="mb-4 text-sm" data-lang-key="precautionsDesc">Click on any precaution to see the detailed steps.</p>
                    <div id="precautions-list" class="space-y-2 border rounded-lg p-2" style="border-color: var(--border-color);">
                        </div>
                </div>
            </div>
        </div>
        
        <footer class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-center">
            <p class="text-sm text-gray-600 dark:text-gray-400 flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" /></svg>
                <span>In India and victim of cybercrime? Call the helpline: <a href="tel:1930" class="font-bold text-indigo-600 hover:underline">1930</a></span>
            </p>
        </footer>
    </div>

    <!-- AI Chatbot Button & Interface -->
    <div id="chatbot-container" class="fixed bottom-6 right-6 z-50 flex flex-col items-end">
        <!-- Chat Window -->
        <div id="chat-window" class="chat-window hidden flex flex-col w-80 md:w-96 h-[500px] bg-[var(--bg-secondary)] rounded-2xl shadow-2xl border border-[var(--border-color)] mb-4 overflow-hidden">
            <!-- Header -->
            <div class="bg-[var(--accent-color)] p-4 flex justify-between items-center text-white">
                <div class="flex items-center gap-2">
                    <div id="ai-status-dot" class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                    <h3 class="font-semibold text-sm">Security Assistant</h3>
                </div>
                <div class="flex items-center space-x-1">
                    <button id="close-chat" class="hover:bg-white/20 rounded-full p-1 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    </button>
                </div>
            </div>

            <!-- Messages Area -->
            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-3 bg-[var(--bg-primary)] text-sm">
                <div class="flex flex-col space-y-2">
                    <div class="bg-[var(--chat-bg-bot)] text-[var(--text-primary)] p-3 rounded-lg rounded-tl-none self-start max-w-[90%] shadow-sm border border-[var(--border-color)]">
                        Hi! I'm your security assistant. I can help you with passwords, phishing, and general security questions. Ask me anything!
                    </div>
                </div>
            </div>
            <!-- Input Area -->
            <div class="p-3 bg-[var(--bg-secondary)] border-t border-[var(--border-color)]">
                <div class="flex gap-2">
                    <input type="text" id="chat-input" placeholder="Ask about security..." class="w-full px-3 py-2 text-sm border rounded-full focus:ring-1 focus:ring-[var(--accent-color)] outline-none bg-[var(--bg-primary)] text-[var(--text-primary)] border-[var(--border-color)]">
                    <button id="send-chat" class="p-2 bg-[var(--accent-color)] text-white rounded-full hover:bg-[var(--accent-hover)] transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" /></svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Floating Action Button -->
        <button id="toggle-chat" class="w-14 h-14 rounded-full shadow-lg bg-[var(--accent-color)] text-white flex items-center justify-center hover:scale-110 active:scale-95 transition-all duration-300 hover:shadow-xl focus:outline-none focus:ring-4 ring-[var(--accent-color)] ring-opacity-30">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
            </svg>
        </button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- TRANSLATIONS ---
            const translations = {
                en: {
                    title: "Digital Security Toolkit",
                    subtitle: "Simple tools to help you stay safe online.",
                    langToggle: "EN / HI",
                    tabMetadata: "Metadata Remover",
                    tabPassword: "Password Tools",
                    tabLink: "Smart Pattern Scanner",
                    tabAwareness: "Threat Awareness",
                    metadataTitle: "Remove Image Metadata",
                    metadataDesc: "Upload a photo to view its hidden data and download a clean, metadata-free version. Your photo is processed in your browser and is never uploaded.",
                    metadataUpload: "Click to upload an image",
                    metadataFound: "Metadata Found (will be removed)",
                    downloadCleaned: "Download Cleaned Image",
                    noExif: "No EXIF data found in this image.",
                    passwordTitle: "Password Tools",
                    passwordDesc: "Generate strong passwords or check if an existing one has been compromised.",
                    passwordBtn: "Check Password",
                    linkTitle: "Smart Pattern Scanner",
                    linkDesc: "Detects suspicious links and risky file types locally using pattern recognition.",
                    linkBtn: "Analyze Link",
                    awarenessGameTitle: "Scam Awareness Game & Alerts",
                    awarenessGameDesc: "Test your knowledge with uniquely generated real-world scenarios.",
                    loadingAlert: "Generating AI Alert...",
                    startGameBtn: "Start AI Awareness Game",
                    scenarioTitle: "Scenario (AI Generated)",
                    scorePrefix: "Score",
                    nextQuestionBtn: "Next Question",
                    playAgainBtn: "Play Again",
                    precautionsTitle: "Essential Security Checklist",
                    precautionsDesc: "Click on any precaution to see the detailed steps.",
                    footer: "© 2025 Digital Security Toolkit. Stay safe!",
                },
                hi: {
                    title: "डिजिटल सुरक्षा टूलकिट",
                    subtitle: "ऑनलाइन सुरक्षित रहने में आपकी मदद करने वाले सरल उपकरण।",
                    langToggle: "EN / HI",
                    tabMetadata: "मेटाडेटा रिमूवर",
                    tabPassword: "पासवर्ड उपकरण",
                    tabLink: "स्मार्ट पैटर्न स्कैनर",
                    tabAwareness: "खतरे की जागरूकता",
                    metadataTitle: "छवि मेटाडेटा हटाएं",
                    metadataDesc: "छिपे हुए डेटा को देखने और एक स्वच्छ, मेटाडेटा-मुक्त संस्करण डाउनलोड करने के लिए एक फोटो अपलोड करें। आपकी तस्वीर आपके ब्राउज़र में संसाधित होती है और कभी अपलोड नहीं होती है।",
                    metadataUpload: "एक छवि अपलोड करने के लिए क्लिक करें",
                    metadataFound: "मेटाडेटा मिला (हटा दिया जाएगा)",
                    downloadCleaned: "साफ की गई छवि डाउनलोड करें",
                    noExif: "इस छवि में कोई EXIF ​​डेटा नहीं मिला।",
                    passwordTitle: "पासवर्ड उपकरण",
                    passwordDesc: "मजबूत पासवर्ड बनाएं या जांचें कि क्या मौजूदा पासवर्ड से समझौता किया गया है।",
                    passwordBtn: "पासवर्ड जांचें",
                    linkTitle: "स्मार्ट पैटर्न स्कैनर",
                    linkDesc: "लिंक और फाइलों के संदिग्ध पैटर्न की स्थानीय रूप से जांच करता है।",
                    linkBtn: "लिंक का विश्लेषण करें",
                    awarenessGameTitle: "घोटाला जागरूकता खेल और अलर्ट",
                    awarenessGameDesc: "वास्तविक दुनिया के परिदृश्यों के साथ अपने ज्ञान का परीक्षण करें और नवीनतम खतरों पर अपडेट रहें।",
                    loadingAlert: "नवीनतम अलर्ट लोड हो रहा है...",
                    startGameBtn: "जागरूकता खेल शुरू करें",
                    scenarioTitle: "परिदृश्य",
                    scorePrefix: "स्कोर",
                    nextQuestionBtn: "अगला प्रश्न",
                    playAgainBtn: "फिर से खेलें",
                    precautionsTitle: "आवश्यक सुरक्षा चेकलिस्ट",
                    precautionsDesc: "विस्तृत चरण देखने के लिए किसी भी सावधानी पर क्लिक करें।",
                    footer: "© 2025 डिजिटल सुरक्षा टूलकिट। सुरक्षित रहें!",
                }
            };

            const languageToggleBtn = document.getElementById('language-toggle');
            let currentLanguage = localStorage.getItem('language') || 'en';

            const setLanguage = (lang) => {
                currentLanguage = lang;
                localStorage.setItem('language', lang);
                document.documentElement.lang = lang;
                document.querySelectorAll('[data-lang-key]').forEach(el => {
                    const key = el.dataset.langKey;
                    if (translations[lang] && translations[lang][key]) {
                        el.innerText = translations[lang][key];
                    }
                });
                renderPrecautionsList(); 
                
                // --- INTELLIGENT CONTENT UPDATE ---
                // Only regenerate IF we have an active alert/game, keeping the SAME topic
                if (currentAlertTopic) {
                    loadLatestScamAlert(currentAlertTopic);
                }
                if (!gameStartScreen.classList.contains('hidden') === false && currentGameTopic) {
                      loadNewScenario(currentGameTopic);
                }
            };
            
            languageToggleBtn.addEventListener('click', () => {
                setLanguage(currentLanguage === 'en' ? 'hi' : 'en');
            });

            // --- THEME & UI SETUP (Existing) ---
            const themeToggleBtn = document.getElementById('theme-toggle');
            const lightIcon = document.getElementById('theme-icon-light');
            const darkIcon = document.getElementById('theme-icon-dark');
            const htmlEl = document.documentElement;

            const applyTheme = (theme) => {
                htmlEl.classList.toggle('dark', theme === 'dark');
                lightIcon.classList.toggle('hidden', theme === 'dark');
                darkIcon.classList.toggle('hidden', theme !== 'dark');
            };
            
            const savedTheme = localStorage.getItem('theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            applyTheme(savedTheme || (systemPrefersDark ? 'dark' : 'light'));

            themeToggleBtn.addEventListener('click', () => {
                const newTheme = htmlEl.classList.contains('dark') ? 'light' : 'dark';
                applyTheme(newTheme);
                localStorage.setItem('theme', newTheme);
            });

            const tabs = document.querySelectorAll('.tab-button');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const target = tab.dataset.tab;
                    tabs.forEach(t => t.classList.remove('tab-active'));
                    tab.classList.add('tab-active');
                    contents.forEach(content => {
                        content.classList.toggle('hidden', content.id !== `${target}-tool`);
                    });
                });
            });

            // --- METADATA REMOVER LOGIC ---
            const imageUpload = document.getElementById('image-upload');
            const metadataResult = document.getElementById('metadata-result');
            const fileNameSpan = document.getElementById('file-name');
            imageUpload.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (!file) {
                    fileNameSpan.textContent = '';
                    metadataResult.innerHTML = '';
                    return;
                }
                fileNameSpan.textContent = file.name;
                metadataResult.innerHTML = `<div class="flex items-center justify-center text-[var(--text-secondary)]"><div class="animate-spin rounded-full h-6 w-6 border-b-2 border-[var(--accent-color)]"></div><span class="ml-2">Processing...</span></div>`;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        canvas.getContext('2d').drawImage(img, 0, 0);
                        canvas.toBlob((blob) => {
                            const cleanedUrl = URL.createObjectURL(blob);
                            
                            EXIF.getData(file, function() {
                                const allTags = EXIF.getAllTags(this);
                                let exifTable = `<div class="p-3 rounded-lg text-center" style="background-color:var(--amber-bg); color:var(--amber-text); border:1px solid var(--amber-border);"><span data-lang-key="noExif">${translations[currentLanguage].noExif}</span></div>`;
                                
                                const tagsToShow = { "Make": allTags.Make, "Model": allTags.Model, "DateTime": allTags.DateTime, "Software": allTags.Software, "GPSLatitude": allTags.GPSLatitude, "GPSLongitude": allTags.GPSLongitude };
                                const foundTags = Object.entries(tagsToShow).filter(([key, value]) => value);

                                if (foundTags.length > 0) {
                                    exifTable = `<table class="w-full text-sm text-left">
                                                    <thead class="text-xs uppercase" style="color: var(--text-secondary); background-color: var(--bg-primary);">
                                                        <tr><th scope="col" class="px-4 py-2 rounded-l-lg">Tag</th><th scope="col" class="px-4 py-2 rounded-r-lg">Value</th></tr>
                                                    </thead><tbody>`;
                                    foundTags.forEach(([key, value]) => {
                                        exifTable += `<tr class="border-b" style="border-color: var(--border-color);"><td class="px-4 py-2 font-medium">${key}</td><td class="px-4 py-2 font-mono text-xs">${value}</td></tr>`;
                                    });
                                    exifTable += `</tbody></table>`;
                                }
                                
                                metadataResult.innerHTML = `
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
                                        <div>
                                            <h3 class="font-semibold text-lg mb-2" data-lang-key="metadataFound">${translations[currentLanguage].metadataFound}</h3>
                                            <div class="max-h-60 overflow-y-auto pr-2">${exifTable}</div>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-lg mb-2">Image Preview</h3>
                                            <img src="${URL.createObjectURL(file)}" alt="Original Preview" class="max-w-full h-auto rounded-lg shadow-md mb-4">
                                            <a href="${cleanedUrl}" download="cleaned_${file.name}" class="w-full text-center block bg-[var(--accent-color)] text-white py-3 rounded-lg font-semibold hover:bg-[var(--accent-hover)] transition-colors" data-lang-key="downloadCleaned">${translations[currentLanguage].downloadCleaned}</a>
                                        </div>
                                    </div>`;
                            });
                        }, file.type);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
                event.target.value = null;
            });

            // --- 1. PASSWORD GENERATOR LOGIC ---
            const genPassBtn = document.getElementById('generate-btn');
            const copyPassBtn = document.getElementById('copy-password');
            const copyIcon = document.getElementById('copy-icon');
            const generatedInput = document.getElementById('generated-password');
            const useSymbols = document.getElementById('use-symbols');
            const useNumbers = document.getElementById('use-numbers');
            const passLengthSlider = document.getElementById('pass-length-slider');
            const passLengthVal = document.getElementById('pass-length-val');

            // Update length display
            passLengthSlider.addEventListener('input', (e) => {
                passLengthVal.textContent = e.target.value;
                generatePassword(); // Regenerate as you slide
            });

            // Checkbox listeners
            useSymbols.addEventListener('change', generatePassword);
            useNumbers.addEventListener('change', generatePassword);

            function generatePassword() {
                const lower = "abcdefghijklmnopqrstuvwxyz";
                const upper = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
                const nums = "0123456789";
                const syms = "!@#$%^&*()_+-=[]{}|;:,.<>?";
                
                let chars = lower + upper;
                if (useNumbers.checked) chars += nums;
                if (useSymbols.checked) chars += syms;

                const length = parseInt(passLengthSlider.value);
                let password = "";
                const array = new Uint32Array(length);
                
                // SECURITY NOTE: This uses the browser's crypto engine, not Math.random()
                window.crypto.getRandomValues(array); 

                for (let i = 0; i < length; i++) {
                    password += chars[array[i] % chars.length];
                }
                generatedInput.value = password;
                
                // Reset copy icon
                copyIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 01-2 2h-8a2 2 0 01-2-2v-8a2 2 0 012-2z" />`;
                copyPassBtn.classList.remove('text-green-600', 'bg-green-100');
            }

            // Initial generation
            generatePassword();

            genPassBtn.addEventListener('click', () => {
                // Add a tiny rotation animation to the icon
                const svg = genPassBtn.querySelector('svg');
                svg.style.transform = 'rotate(180deg)';
                svg.style.transition = 'transform 0.3s ease';
                setTimeout(() => svg.style.transform = 'rotate(0deg)', 300);
                generatePassword();
            });

            copyPassBtn.addEventListener('click', () => {
                if(!generatedInput.value) return;
                navigator.clipboard.writeText(generatedInput.value);
                
                // Visual Feedback
                copyIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />`;
                copyPassBtn.classList.add('text-green-600', 'bg-green-100');
                
                // Reset after 2 seconds
                setTimeout(() => {
                    copyIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 01-2 2h-8a2 2 0 01-2-2v-8a2 2 0 012-2z" />`;
                    copyPassBtn.classList.remove('text-green-600', 'bg-green-100');
                }, 2000);
            });

            // --- PASSWORD CHECKER LOGIC ---
            const passwordInput = document.getElementById('password-input');
            const togglePasswordBtn = document.getElementById('toggle-password');
            const checkPasswordBtn = document.getElementById('check-password-btn');
            const passwordResult = document.getElementById('password-result');
            const eyeOpen = document.getElementById('eye-open');
            const eyeClosed = document.getElementById('eye-closed');

            togglePasswordBtn.addEventListener('click', () => {
                const isPassword = passwordInput.type === 'password';
                passwordInput.type = isPassword ? 'text' : 'password';
                eyeOpen.classList.toggle('hidden', isPassword);
                eyeClosed.classList.toggle('hidden', !isPassword);
            });

            checkPasswordBtn.addEventListener('click', async () => {
                const password = passwordInput.value;
                passwordResult.innerHTML = `<div class="flex items-center justify-center text-[var(--text-secondary)]"><div class="animate-spin rounded-full h-6 w-6 border-b-2 border-[var(--accent-color)]"></div><span class="ml-2">Checking...</span></div>`;
                if (!password) {
                    passwordResult.innerHTML = `<div class="p-4 rounded-lg" style="background-color:var(--amber-bg); color:var(--amber-text); border:1px solid var(--amber-border);">Please enter a password.</div>`;
                    return;
                }
                const strength = checkPasswordStrength(password);
                const pwnedCount = await checkPwned(password);
                let resultHTML = '<div class="space-y-3">';
                resultHTML += strength.html;
                if (pwnedCount === null) {
                    resultHTML += `<div class="p-3 rounded-md bg-gray-100 text-gray-700">Could not check for breaches.</div>`;
                } else if (pwnedCount > 0) {
                    resultHTML += `<div class="p-3 rounded-md flex items-center" style="background-color:var(--red-bg); color:var(--red-text); border:1px solid var(--red-border);"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.21 3.03-1.742 3.03H4.42c-1.532 0-2.492-1.696-1.742-3.03l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" /></svg><strong>Oh no!</strong> This password was found in <strong>${pwnedCount.toLocaleString()}</strong> data breaches.</div>`;
                } else {
                    resultHTML += `<div class="p-3 rounded-md flex items-center" style="background-color:var(--green-bg); color:var(--green-text); border:1px solid var(--green-border);"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg><strong>Good news!</strong> This password was not found in any known breaches.</div>`;
                }
                resultHTML += '</div>';
                passwordResult.innerHTML = resultHTML;
            });

            function checkPasswordStrength(password) {
                let score = 0;
                if (password.length >= 12) score++;
                if (/[a-z]/.test(password)) score++;
                if (/[A-Z]/.test(password)) score++;
                if (/\d/.test(password)) score++;
                if (/[^A-Za-z0-9]/.test(password)) score++;
                let message, style;
                switch (score) {
                    case 0: case 1: case 2: message = 'Weak'; style = 'background-color:var(--red-bg); color:var(--red-text); border:1px solid var(--red-border);'; break;
                    case 3: case 4: message = 'Strong'; style = 'background-color:var(--amber-bg); color:var(--amber-text); border:1px solid var(--amber-border);'; break;
                    case 5: message = 'Very Strong'; style = 'background-color:var(--green-bg); color:var(--green-text); border:1px solid var(--green-border);'; break;
                }
                return { html: `<div class="p-3 rounded-md" style="${style}"><strong>Strength:</strong> ${message}</div>` };
            }

            async function checkPwned(password) {
                try {
                    const msgBuffer = new TextEncoder().encode(password);
                    const hashBuffer = await crypto.subtle.digest('SHA-1', msgBuffer);
                    const hashHex = Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
                    const prefix = hashHex.substring(0, 5);
                    const suffix = hashHex.substring(5).toUpperCase();
                    const response = await fetch(`https://api.pwnedpasswords.com/range/${prefix}`);
                    if (!response.ok) throw new Error();
                    const data = await response.text();
                    const match = data.split('\r\n').find(line => line.split(':')[0] === suffix);
                    return match ? parseInt(match.split(':')[1]) : 0;
                } catch (error) { return null; }
            }

             // --- 2. SECURE ENCRYPTION LOGIC (AES-GCM) ---
            const cryptoKeyInput = document.getElementById('crypto-key');
            const cryptoInput = document.getElementById('crypto-input');
            const cryptoOutput = document.getElementById('crypto-output');
            const btnEncrypt = document.getElementById('btn-encrypt');
            const btnDecrypt = document.getElementById('btn-decrypt');

            const getCryptoKey = async (password, salt, usage) => {
                const enc = new TextEncoder();
                const keyMaterial = await window.crypto.subtle.importKey(
                    "raw", enc.encode(password), { name: "PBKDF2" }, false, ["deriveKey"]
                );
                return window.crypto.subtle.deriveKey(
                    { name: "PBKDF2", salt: salt, iterations: 100000, hash: "SHA-256" },
                    keyMaterial, { name: "AES-GCM", length: 256 }, false, usage
                );
            };

            const arrayBufferToBase64 = (buffer) => {
                let binary = '';
                const bytes = new Uint8Array(buffer);
                for (let i = 0; i < bytes.byteLength; i++) binary += String.fromCharCode(bytes[i]);
                return window.btoa(binary);
            };

            const base64ToArrayBuffer = (base64) => {
                const binary_string = window.atob(base64);
                const len = binary_string.length;
                const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) bytes[i] = binary_string.charCodeAt(i);
                return bytes.buffer;
            };

            btnEncrypt.addEventListener('click', async () => {
                const password = cryptoKeyInput.value;
                const text = cryptoInput.value;
                if (!password || !text) return alert("Please enter a password and text.");

                try {
                    const salt = window.crypto.getRandomValues(new Uint8Array(16));
                    const iv = window.crypto.getRandomValues(new Uint8Array(12));
                    const key = await getCryptoKey(password, salt, ["encrypt"]);
                    const enc = new TextEncoder();
                    
                    const encryptedContent = await window.crypto.subtle.encrypt(
                        { name: "AES-GCM", iv: iv }, key, enc.encode(text)
                    );

                    const result = `${arrayBufferToBase64(salt)}:${arrayBufferToBase64(iv)}:${arrayBufferToBase64(encryptedContent)}`;
                    cryptoOutput.value = result;
                } catch (e) {
                    console.error(e);
                    alert("Encryption failed.");
                }
            });

            btnDecrypt.addEventListener('click', async () => {
                const password = cryptoKeyInput.value;
                const encryptedData = cryptoInput.value.trim();
                if (!password || !encryptedData) return alert("Please enter password and encrypted code.");

                try {
                    const parts = encryptedData.split(':');
                    if (parts.length !== 3) throw new Error("Invalid format");

                    const salt = base64ToArrayBuffer(parts[0]);
                    const iv = base64ToArrayBuffer(parts[1]);
                    const ciphertext = base64ToArrayBuffer(parts[2]);

                    const key = await getCryptoKey(password, salt, ["decrypt"]);
                    
                    const decryptedContent = await window.crypto.subtle.decrypt(
                        { name: "AES-GCM", iv: iv }, key, ciphertext
                    );

                    const dec = new TextDecoder();
                    cryptoOutput.value = dec.decode(decryptedContent);
                } catch (e) {
                    console.error(e);
                    cryptoOutput.value = "Error: Decryption failed. Wrong password or corrupted data.";
                }
            });


            // --- 3. SMART PATTERN SCANNER LOGIC (Heuristic) ---
            const modeLinkBtn = document.getElementById('mode-link');
            const modeFileBtn = document.getElementById('mode-file');
            const vtUrlSection = document.getElementById('vt-url-section');
            const vtFileSection = document.getElementById('vt-file-section');
            
            const linkInput = document.getElementById('link-input');
            const scanLinkBtn = document.getElementById('scan-link-btn');
            const linkResult = document.getElementById('link-result');
            
            const vtFileInput = document.getElementById('vt-file-input');
            const vtFileName = document.getElementById('vt-file-name');
            const scanFileBtn = document.getElementById('scan-file-btn');

            // Toggle Modes
            modeLinkBtn.addEventListener('click', () => {
                modeLinkBtn.classList.add('bg-[var(--accent-color)]', 'text-white');
                modeLinkBtn.classList.remove('bg-[var(--bg-primary)]', 'text-[var(--text-secondary)]');
                modeFileBtn.classList.remove('bg-[var(--accent-color)]', 'text-white');
                modeFileBtn.classList.add('bg-[var(--bg-primary)]', 'text-[var(--text-secondary)]');
                vtUrlSection.classList.remove('hidden');
                vtFileSection.classList.add('hidden');
                linkResult.innerHTML = '';
            });
            
            modeFileBtn.addEventListener('click', () => {
                modeFileBtn.classList.add('bg-[var(--accent-color)]', 'text-white');
                modeFileBtn.classList.remove('bg-[var(--bg-primary)]', 'text-[var(--text-secondary)]');
                modeLinkBtn.classList.remove('bg-[var(--accent-color)]', 'text-white');
                modeLinkBtn.classList.add('bg-[var(--bg-primary)]', 'text-[var(--text-secondary)]');
                vtFileSection.classList.remove('hidden');
                vtUrlSection.classList.add('hidden');
                linkResult.innerHTML = '';
            });

            // Helper to render findings
            const renderFindings = (score, findings) => {
                let colorClass = 'green';
                let title = 'Safe';
                let desc = 'No obvious threats found in the pattern analysis.';

                if (score >= 50) {
                    colorClass = 'red';
                    title = 'High Risk Detected';
                    desc = 'This input shows multiple signs of being malicious.';
                } else if (score > 0) {
                    colorClass = 'amber';
                    title = 'Suspicious';
                    desc = 'Proceed with caution. Some patterns look risky.';
                }

                const bg = `var(--${colorClass}-bg)`;
                const text = `var(--${colorClass}-text)`;
                const border = `var(--${colorClass}-border)`;

                let listHtml = findings.length > 0 
                    ? `<ul class="list-disc list-inside mt-2 text-sm space-y-1">${findings.map(f => `<li>${f}</li>`).join('')}</ul>`
                    : '';

                linkResult.innerHTML = `
                    <div class="p-4 rounded-lg" style="background-color:${bg}; color:${text}; border:1px solid ${border};">
                        <div class="flex justify-between items-center">
                            <h4 class="font-bold text-lg">${title}</h4>
                            <span class="text-xs font-bold px-2 py-1 rounded bg-white bg-opacity-50">Risk Score: ${score}/100</span>
                        </div>
                        <p class="text-sm mt-1">${desc}</p>
                        ${listHtml}
                    </div>
                `;
            };

            // LINK ANALYSIS
            scanLinkBtn.addEventListener('click', () => {
                const url = linkInput.value.trim();
                if (!url) return;
                
                linkResult.innerHTML = `<div class="flex items-center justify-center text-[var(--text-secondary)]"><div class="animate-spin rounded-full h-6 w-6 border-b-2 border-[var(--accent-color)]"></div><span class="ml-2">Analyzing...</span></div>`;

                setTimeout(() => {
                    let riskScore = 0;
                    let findings = [];

                    try {
                        // Basic format check
                        if (!url.startsWith('http')) {
                            findings.push("Missing protocol (http/https).");
                        }

                        const urlObj = new URL(url.startsWith('http') ? url : `http://${url}`);
                        const domain = urlObj.hostname.toLowerCase();

                        // 1. Protocol Check
                        if (urlObj.protocol === 'http:') {
                            riskScore += 20;
                            findings.push("Insecure connection (HTTP). Secure sites use HTTPS.");
                        }

                        // 2. IP Address Check
                        if (/^(\d{1,3}\.){3}\d{1,3}$/.test(domain)) {
                            riskScore += 50;
                            findings.push("Host is a raw IP address. Legit sites usually have names.");
                        }

                        // 3. Risky TLDs
                        const riskyTlds = ['.xyz', '.top', '.zip', '.mov', '.tk', '.ml', '.ga', '.cf', '.gq', '.ru', '.cn', '.download', '.review', '.country'];
                        if (riskyTlds.some(tld => domain.endsWith(tld))) {
                            riskScore += 30;
                            findings.push(`Suspicious Top-Level Domain (TLD): ${domain.split('.').pop()}`);
                        }

                        // 4. Obfuscation
                        if (url.includes('@')) {
                            riskScore += 40;
                            findings.push("Contains '@' symbol. This is often used to trick browsers.");
                        }

                        // 5. Length
                        if (domain.length > 30) {
                            riskScore += 10;
                            findings.push("Unusually long domain name.");
                        }

                    } catch (e) {
                        renderFindings(10, ["Invalid URL format."]);
                        return;
                    }

                    renderFindings(riskScore, findings);
                }, 800);
            });

            // FILE ANALYSIS
            vtFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    vtFileName.textContent = file.name;
                    scanFileBtn.disabled = false;
                }
            });

            scanFileBtn.addEventListener('click', () => {
                const file = vtFileInput.files[0];
                if (!file) return;

                linkResult.innerHTML = `<div class="flex items-center justify-center text-[var(--text-secondary)]"><div class="animate-spin rounded-full h-6 w-6 border-b-2 border-[var(--accent-color)]"></div><span class="ml-2">Analyzing File Pattern...</span></div>`;

                setTimeout(() => {
                    let riskScore = 0;
                    let findings = [];
                    const name = file.name.toLowerCase();
                    const sizeMB = file.size / (1024 * 1024);

                    // 1. Dangerous Extensions
                    const dangerousExts = ['.exe', '.scr', '.bat', '.com', '.vbs', '.js', '.jar', '.msi', '.cmd', '.pif'];
                    const ext = name.substring(name.lastIndexOf('.'));
                    
                    if (dangerousExts.includes(ext)) {
                        riskScore += 60;
                        findings.push(`High-risk file extension detected (${ext}). Executable files can install malware.`);
                    }

                    // 2. Double Extension Attack (e.g., invoice.pdf.exe)
                    // Regex looks for: something . (3-4 chars) . (3-4 chars)
                    if (/\.[a-z0-9]{3,4}\.[a-z0-9]{3,4}$/.test(name)) {
                        riskScore += 80;
                        findings.push("Double Extension detected! This file is trying to hide its true type (e.g. 'scan.pdf.exe').");
                    }

                    // 3. Windows Shortcuts (LNK)
                    if (name.endsWith('.lnk')) {
                        riskScore += 70;
                        findings.push(".LNK file detected. Shortcuts are commonly used to run hidden powershell scripts.");
                    }

                    // 4. Office Macros (Macro-enabled)
                    if (['.docm', '.xlsm', '.pptm'].includes(ext)) {
                        riskScore += 40;
                        findings.push("Macro-enabled Office document. Do not enable content unless you trust the source.");
                    }

                    // 5. Suspiciously small executables
                    if (dangerousExts.includes(ext) && sizeMB < 0.1) {
                        riskScore += 20;
                        findings.push("Very small executable file. Malware loaders are often tiny.");
                    }

                    renderFindings(riskScore, findings);
                }, 800);
            });

            // --- DYNAMIC SCAM GAME & ALERTS LOGIC (Hybrid AI + Local Fallback) ---
            const gameStartScreen = document.getElementById('game-start-screen');
            const gameQuestionScreen = document.getElementById('game-question-screen');
            const gameScoreEl = document.getElementById('game-score');
            const gameScenarioEl = document.getElementById('game-scenario');
            const gameOptionsEl = document.getElementById('game-options');
            const gameFeedbackEl = document.getElementById('game-feedback');
            const gameNextBtn = document.getElementById('game-next-btn');
            const refreshAlertBtn = document.getElementById('refresh-alert-btn');
            const scamAlertTitleEl = document.getElementById('scam-alert-title');
            const scamAlertDescriptionEl = document.getElementById('scam-alert-description');
            const gameLoading = document.getElementById('game-loading');
            
            let score = 0;
            let currentAlertTopic = null; // Store topic to persist across lang switches
            let currentGameTopic = null; // Store topic to persist across lang switches

            // Local Generators for Instant Fallback (EXPANDED FOR VARIETY)
            const attackTypes = { 
                en: ["Phishing Email", "Fake SMS", "Tech Support Call", "Malicious Ad", "Fake Wi-Fi", "QR Code Scam", "Fake Amazon Order", "Netflix Suspension", "IRS/Tax Audit", "Grandchild in Jail Call", "Crypto Wallet Drainer", "Fake Job Offer"], 
                hi: ["फिशिंग ईमेल", "फर्जी एसएमएस", "टेक सपोर्ट कॉल", "दुर्भावनापूर्ण विज्ञापन", "फर्जी वाई-फाई", "क्यूआर कोड घोटाला", "फर्जी अमेज़न ऑर्डर", "नेटफ्लिक्स सस्पेंशन", "आयकर विभाग का नोटिस", "रिश्तेदार की मुसीबत कॉल", "क्रिप्टो वॉलेट चोरी", "फर्जी नौकरी का ऑफर"] 
            };
            const targets = { 
                en: ["Bank Password", "Credit Card Number", "Social Security Number", "OTP", "Home Address", "UPI PIN", "Login Cookies", "Passport Details"], 
                hi: ["बैंक पासवर्ड", "क्रेडिट कार्ड नंबर", "सामाजिक सुरक्षा नंबर", "ओटीपी", "घर का पता", "यूपीआई पिन", "लॉगिन कुकीज़", "पासपोर्ट विवरण"] 
            };
            const contexts = { 
                en: ["claiming you won a lottery", "saying your account is locked", "offering a free gift", "demanding urgent payment", "asking to verify identity", "threatening legal action", "claiming a package is undelivered", "offering a refund"], 
                hi: ["लॉटरी जीतने का दावा", "खाता लॉक होने की बात", "मुफ्त उपहार की पेशकश", "तत्काल भुगतान की मांग", "पहचान सत्यापित करने के लिए कहना", "कानूनी कार्रवाई की धमकी", "पैकेज वितरित न होने का दावा", "रिफंड की पेशकश"] 
            };
            const goodActions = { 
                en: ["Delete and ignore", "Verify via official app", "Hang up and call bank", "Do not click links", "Report as spam", "Check URL carefully"], 
                hi: ["हटाएं और अनदेखा करें", "आधिकारिक ऐप के माध्यम से सत्यापित करें", "फोन काट दें और बैंक को कॉल करें", "लिंक पर क्लिक न करें", "स्पैम के रूप में रिपोर्ट करें", "URL ध्यान से जांचें"] 
            };
            const badActions = { 
                en: ["Click the link instantly", "Share the OTP", "Download the attachment", "Call the number provided", "Reply with personal info", "Pay the fee immediately"], 
                hi: ["तुरंत लिंक पर क्लिक करें", "ओटीपी साझा करें", "अटैचमेंट डाउनलोड करें", "दिए गए नंबर पर कॉल करें", "व्यक्तिगत जानकारी के साथ उत्तर दें", "तुरंत शुल्क का भुगतान करें"] 
            };

            function generateLocalScenario(lang) {
                const type = attackTypes[lang][Math.floor(Math.random() * attackTypes[lang].length)];
                const target = targets[lang][Math.floor(Math.random() * targets[lang].length)];
                const context = contexts[lang][Math.floor(Math.random() * contexts[lang].length)];
                const correct = goodActions[lang][Math.floor(Math.random() * goodActions[lang].length)];
                const wrong1 = badActions[lang][Math.floor(Math.random() * badActions[lang].length)];
                const wrong2 = badActions[lang][Math.floor(Math.random() * badActions[lang].length)];
                
                const scenarioText = lang === 'hi' 
                    ? `आपको एक ${type} प्राप्त होता है जो ${context} कर रहा है और आपका ${target} मांग रहा है।`
                    : `You receive a ${type} ${context} asking for your ${target}.`;

                return {
                    scenario: scenarioText,
                    options: [
                        { text: wrong1, correct: false },
                        { text: correct, correct: true },
                        { text: wrong2, correct: false }
                    ].sort(() => Math.random() - 0.5),
                    explanation: lang === 'hi' ? "हमेशा आधिकारिक चैनलों के माध्यम से सत्यापित करें।" : "Always verify via official channels."
                };
            }

            function generateLocalAlert(lang) {
                const type = attackTypes[lang][Math.floor(Math.random() * attackTypes[lang].length)];
                const context = contexts[lang][Math.floor(Math.random() * contexts[lang].length)];
                return {
                    title: `${type} Alert`,
                    description: lang === 'hi' ? `सावधान रहें: हमलावर ${context} का उपयोग कर रहे हैं।` : `Be careful: Attackers are ${context}.`
                };
            }

            document.getElementById('start-game-btn').addEventListener('click', startGame);
            gameNextBtn.addEventListener('click', nextScenario);
            
            // Click listener for manual refresh (picks new topic)
            refreshAlertBtn.addEventListener('click', () => loadLatestScamAlert());

            // Helper to call AI specifically for JSON with language enforcement
            async function fetchAIJSON(prompt, lang) {
                try {
                    // Add timestamp to ensure seed is always unique
                    const uniqueSeed = Date.now() + Math.floor(Math.random() * 1000000);
                    let langInstruction = "Keep values in English.";
                    if (lang === 'hi') {
                        langInstruction = "CRITICAL: Output values MUST be in Hindi (Devanagari script). Do not output English text for values.";
                    }

                    const finalPrompt = `${prompt} [UniqueSeed: ${uniqueSeed}] ${langInstruction} Respond ONLY with valid JSON. No markdown. Keys must be in English.`;
                    
                    const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(finalPrompt)}`);

                    if (!response.ok) throw new Error("Network error");
                    const text = await response.text();
                    
                    const jsonMatch = text.match(/\{[\s\S]*\}/);
                    if (!jsonMatch) throw new Error("No JSON found");
                    
                    return JSON.parse(jsonMatch[0]);
                } catch (e) {
                    console.warn("AI Failed, using local generator.", e);
                    return null;
                }
            }

            async function startGame() {
                score = 0;
                gameStartScreen.classList.add('hidden');
                gameQuestionScreen.classList.remove('hidden');
                gameNextBtn.innerText = translations[currentLanguage].nextQuestionBtn;
                await loadNewScenario();
            }

            async function loadNewScenario(specificTopic = null) {
                gameLoading.classList.remove('hidden');
                gameScenarioEl.classList.add('hidden');
                gameOptionsEl.innerHTML = '';
                gameFeedbackEl.innerHTML = '';
                gameNextBtn.classList.add('hidden');

                let scenarioData = null;

                // Determine Topic (EXPANDED LIST)
                const topics = [
                    'phishing email', 'smishing (SMS scam)', 'vishing (voice scam)', 'malware download', 
                    'ransomware attack', 'weak password', 'public wifi eavesdropping', 'social engineering', 
                    'identity theft', 'fake online store', 'tech support scam', 'romance scam', 
                    'CEO fraud', 'cryptocurrency drainer', 'fake job offer', 'QR code quishing', 
                    'browser extension malware', 'fake antivirus', 'USB drive drop', 'cloud account takeover'
                ];
                
                // Use provided topic (for translations) or pick new one
                currentGameTopic = specificTopic || topics[Math.floor(Math.random() * topics.length)];
                
                const langPrompt = currentLanguage === 'hi' ? 'in Hindi' : 'in English';
                
                // More detailed prompt to force variety
                const prompt = `Generate 1 unique and detailed cybersecurity scam quiz question ${langPrompt} about ${currentGameTopic}. Invent specific details (e.g. a fictional company name, specific threat context). Return JSON format: {"scenario": "detailed question text", "options": [{"text": "bad option A", "correct": false}, {"text": "good option B", "correct": true}, {"text": "bad option C", "correct": false}], "explanation": "short explanation"}`;
                
                scenarioData = await fetchAIJSON(prompt, currentLanguage);

                // Fallback to Local Generator
                if (!scenarioData || !scenarioData.scenario || !scenarioData.options) {
                    scenarioData = generateLocalScenario(currentLanguage);
                }

                gameLoading.classList.add('hidden');
                gameScenarioEl.classList.remove('hidden');
                
                gameScoreEl.innerHTML = `<span data-lang-key="scorePrefix">${translations[currentLanguage].scorePrefix}</span>: ${score}`;
                gameScenarioEl.textContent = scenarioData.scenario;
                gameOptionsEl.innerHTML = scenarioData.options.map(option => 
                    `<button class="w-full text-left p-3 border rounded-lg option-btn hover:bg-[var(--bg-primary)]" style="border-color:var(--border-color);">${option.text}</button>`
                ).join('');
                
                gameOptionsEl.querySelectorAll('.option-btn').forEach((button, index) => {
                    button.onclick = () => selectAnswer(scenarioData.options[index], button, scenarioData.explanation);
                });
            }

            function selectAnswer(option, btn, explanation) {
                Array.from(gameOptionsEl.children).forEach(button => button.disabled = true);
                btn.classList.add(option.correct ? 'correct' : 'incorrect');
                if (option.correct) score++;
                
                gameFeedbackEl.innerHTML = `<div class="p-3 rounded-md" style="background-color:${option.correct ? 'var(--green-bg)' : 'var(--red-bg)'}; color:${option.correct ? 'var(--green-text)' : 'var(--red-text)'}; border:1px solid ${option.correct ? 'var(--green-border)' : 'var(--red-border)'};"><p class="font-bold">${option.correct ? 'Correct!' : 'Incorrect'}</p><p class="text-sm">${explanation}</p></div>`;
                gameScoreEl.innerHTML = `<span data-lang-key="scorePrefix">${translations[currentLanguage].scorePrefix}</span>: ${score}`;
                gameNextBtn.classList.remove('hidden');
            }

            async function nextScenario() {
                 await loadNewScenario(); // Generates NEW topic
            }

            async function loadLatestScamAlert(specificTopic = null) {
                // Only set loading text if it's a fresh load or manual refresh, not a translation switch
                if (!specificTopic) {
                    scamAlertTitleEl.textContent = "Loading...";
                    scamAlertDescriptionEl.textContent = "...";
                }
                
                // EXPANDED ALERT TOPICS
                const alertTopics = [
                    "AI Voice Cloning", "QR Code Fraud", "Fake Job Offers", "Romance Scams", 
                    "Tech Support Fraud", "Package Delivery Smishing", "Crypto Investment Scams", 
                    "Charity Fraud", "Social Media Impersonation", "Fake Wi-Fi Hotspots",
                    "Ransomware", "Deepfake Video Calls", "SIM Swapping", "Fake Antivirus Popups", 
                    "Tax Refund Scams", "Ticket Booking Scams", "Gaming Skin Theft", "Fake Loan Apps",
                    "Lottery Fraud", "Sextortion Emails"
                ];
                
                // Use existing topic if translating, else pick new one
                currentAlertTopic = specificTopic || alertTopics[Math.floor(Math.random() * alertTopics.length)];

                const langPrompt = currentLanguage === 'hi' ? 'in Hindi' : 'in English';
                // More specific prompt
                const prompt = `Generate 1 realistic and specific cybersecurity scam alert about ${currentAlertTopic} ${langPrompt}. Include a specific tactic being used. Return JSON: {"title": "Short Title", "description": "One sentence description"}`;
                
                let alertData = await fetchAIJSON(prompt, currentLanguage);
                
                if (!alertData || !alertData.title) {
                    alertData = generateLocalAlert(currentLanguage);
                }
                
                scamAlertTitleEl.textContent = alertData.title;
                scamAlertDescriptionEl.textContent = alertData.description;
            }
            
            // --- PRECAUTIONS LIST LOGIC (Existing) ---
            const precautionsListContainer = document.getElementById('precautions-list');
             function renderPrecautionsList() {
                 const precautionsData = {
                     en: [
                         { title: "Use a Password Manager", steps: ["Choose a reputable manager (e.g., Bitwarden).", "Create one strong master password.", "Let the manager generate unique passwords.", "Enable 2FA on the manager."] },
                         { title: "Enable Two-Factor Authentication (2FA)", steps: ["Go to security settings of important accounts.", "Use an authenticator app.", "Scan the QR code to link.", "Save backup codes offline."] },
                         { title: "Recognize & Avoid Phishing", steps: ["Be suspicious of emails that create urgency.", "Check the sender's email address carefully.", "Hover over links to see the real URL.", "Never provide passwords in response to an email."] },
                         { title: "Keep Your Software Updated", steps: ["Enable automatic updates for your OS and browser.", "Regularly update other applications.", "Remove any software you no longer use."] },
                         { title: "Secure Your Home Wi-Fi", steps: ["Change the default admin password of your router.", "Ensure your network uses WPA3 or WPA2 encryption.", "Choose a strong password for your Wi-Fi.", "Enable a guest network for visitors."] }
                     ],
                     hi: [
                         { title: "पासवर्ड मैनेजर का उपयोग करें", steps: ["एक प्रतिष्ठित मैनेजर चुनें (जैसे, बिटवार्डेन)।", "एक मजबूत मास्टर पासवर्ड बनाएं।", "मैनेजर को यूनिक पासवर्ड बनाने दें।", "मैनेजर पर 2FA सक्षम करें।"] },
                         { title: "टू-फैक्टर ऑथेंटिकेशन (2FA) सक्षम करें", steps: ["महत्वपूर्ण खातों की सुरक्षा सेटिंग्स पर जाएं।", "एक ऑथेंटिकेटर ऐप का उपयोग करें।", "लिंक करने के लिए QR कोड स्कैन करें।", "बैकअप कोड ऑफ़लाइन सहेजें।"] },
                         { title: "फ़िशिंग को पहचानें और उससे बचें", steps: ["जरूरी काम का अहसास कराने वाले ईमेल से सावधान रहें।", "भेजने वाले का ईमेल पता ध्यान से जांचें।", "असली यूआरएल देखने के लिए लिंक पर होवर करें।", "ईमेल के जवाब में कभी भी पासवर्ड न दें।"] },
                         { title: "अपने सॉफ्टवेयर को अपडेट रखें", steps: ["अपने ओएस और ब्राउज़र के लिए स्वचालित अपडेट सक्षम करें।", "अन्य एप्लिकेशन को नियमित रूप से अपडेट करें।", "जो सॉफ्टवेयर आप अब उपयोग नहीं करते हैं उसे हटा दें।"] },
                         { title: "अपने होम वाई-फाई को सुरक्षित करें", steps: ["अपने राउटर का डिफ़ॉल्ट एडमिन पासवर्ड बदलें।", "सुनिश्चित करें कि आपका नेटवर्क WPA3 या WPA2 एन्क्रिप्शन का उपयोग करता है।", "अपने वाई-फाई के लिए एक मजबूत पासवर्ड चुनें।", "मेहमानों के लिए एक गेस्ट नेटवर्क सक्षम करें।"] }
                     ]
                 };
                 const data = precautionsData[currentLanguage];
                 precautionsListContainer.innerHTML = data.map(item => `
                     <div class="precaution-item border-b last:border-b-0" style="border-color: var(--border-color);">
                         <div class="precaution-header flex justify-between items-center p-3 cursor-pointer">
                             <h3 class="font-medium">${item.title}</h3>
                             <span class="precaution-icon text-[var(--accent-color)]"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" /></svg></span>
                         </div>
                         <div class="precaution-steps pl-4 pr-2"><ul class="list-disc list-inside space-y-2 text-sm pb-4" style="color: var(--text-secondary);">${item.steps.map(step => `<li>${step}</li>`).join('')}</ul></div>
                     </div>`).join('');
             }
             precautionsListContainer.addEventListener('click', (e) => {
                const header = e.target.closest('.precaution-header');
                if (!header) return;
                const item = header.parentElement;
                const currentlyActive = document.querySelector('.precaution-item.active');
                if (currentlyActive && currentlyActive !== item) {
                    currentlyActive.classList.remove('active');
                }
                item.classList.toggle('active');
            });

            // --- PROPER AI CHATBOT LOGIC (Pollinations.ai) ---
            const toggleChatBtn = document.getElementById('toggle-chat');
            const chatWindow = document.getElementById('chat-window');
            const closeChatBtn = document.getElementById('close-chat');
            const chatInput = document.getElementById('chat-input');
            const sendChatBtn = document.getElementById('send-chat');
            const chatMessages = document.getElementById('chat-messages');

            toggleChatBtn.addEventListener('click', () => {
                chatWindow.classList.toggle('hidden');
                if(!chatWindow.classList.contains('hidden')) chatInput.focus();
            });

            closeChatBtn.addEventListener('click', () => chatWindow.classList.add('hidden'));

            const appendMessage = (text, isUser) => {
                const div = document.createElement('div');
                div.className = isUser 
                    ? `bg-[var(--chat-bg-user)] text-white p-3 rounded-lg rounded-tr-none self-end max-w-[85%] shadow-sm`
                    : `bg-[var(--chat-bg-bot)] text-[var(--text-primary)] p-3 rounded-lg rounded-tl-none self-start max-w-[85%] shadow-sm border border-[var(--border-color)] prose-sm`;
                
                if (!isUser && typeof marked !== 'undefined') {
                    try {
                        div.innerHTML = marked.parse(text);
                    } catch (e) {
                        div.innerText = text;
                    }
                } else {
                    div.innerText = text;
                }

                const wrapper = document.createElement('div');
                wrapper.className = "flex flex-col space-y-2";
                wrapper.appendChild(div);
                chatMessages.appendChild(wrapper);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            };

            // Call Pollinations.ai API (No Key Required)
            const callPollinationsAI = async (userText) => {
                try {
                    const encodedText = encodeURIComponent(`You are a helpful digital security assistant. Be comprehensive. User: ${userText}`);
                    const response = await fetch(`https://text.pollinations.ai/${encodedText}`);

                    if (!response.ok) throw new Error("Network error");
                    
                    const text = await response.text();
                    return text.trim();

                } catch (error) {
                    console.error("AI Error Details:", error);
                    return "I'm having trouble connecting to the AI brain right now. Please check your internet connection.";
                }
            };

            const handleChatSubmit = async () => {
                const text = chatInput.value.trim();
                if (!text) return;
                
                appendMessage(text, true);
                chatInput.value = '';

                const typingIndicator = document.createElement('div');
                typingIndicator.className = "bg-[var(--chat-bg-bot)] text-[var(--text-primary)] p-3 rounded-lg rounded-tl-none self-start max-w-[85%] shadow-sm border border-[var(--border-color)] flex space-x-1 w-16 items-center justify-center";
                typingIndicator.innerHTML = `<div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div><div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div><div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>`;
                const wrapper = document.createElement('div');
                wrapper.className = "flex flex-col space-y-2";
                wrapper.appendChild(typingIndicator);
                chatMessages.appendChild(wrapper);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                const response = await callPollinationsAI(text);
                
                chatMessages.removeChild(wrapper);
                appendMessage(response, false);
                
                // Navigation Logic
                if (response.toLowerCase().includes("password checker")) document.querySelector('[data-tab="password"]').click();
                if (response.toLowerCase().includes("metadata remover")) document.querySelector('[data-tab="metadata"]').click();
                if (response.toLowerCase().includes("link scanner")) document.querySelector('[data-tab="link"]').click();
            };

            sendChatBtn.addEventListener('click', handleChatSubmit);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleChatSubmit();
            });

            setLanguage(currentLanguage);
            // Trigger initial alert generation on load
            loadLatestScamAlert();
        });
    </script>
    
</body>
</html>
